npm install && ADMIN_PASS=$(openssl rand -hex 12) && printf "ADMIN_EMAIL=%s\nADMIN_PASS=%s\n" "seuemail@dominio.com" "$ADMIN_PASS" > .env.local && mkdir -p public/games && cp -v ./game_images/* public/games/ 2>/dev/null || true && node -e 'const fs=require("fs"); try{ const pkg=JSON.parse(fs.readFileSync("package.json")); if(pkg.dependencies && pkg.dependencies["react-scripts"]){ pkg.homepage = "."; fs.writeFileSync("package.json", JSON.stringify(pkg,null,2)); console.log("CRA detected - homepage set to ."); } else if(fs.existsSync("next.config.js")){ let existing = {}; try{ existing = require(process.cwd()+"/next.config.js"); }catch(e){} const cfg = "module.exports = " + JSON.stringify(Object.assign(existing,{ assetPrefix: "", basePath: "" }), null, 2) + ";"; fs.writeFileSync("next.config.js", cfg); console.log("Next.js detected - next.config.js patched"); } else { console.log("No CRA/Next.js detected - please verify asset paths"); } }catch(e){ console.error("Error patching config:", e); }' && npm run build && echo "-- checking build assets --" && if [ -d build ]; then JSFILE=$(find build -type f -name "*.js" | head -n1); if [ -n "$JSFILE" ]; then echo "Found js: $JSFILE"; if head -c 1 "$JSFILE" | od -An -t x1 | tr -d ' \n' | grep -iq '^3c'; then echo "ERROR: built js starts with 3c (<) -> likely HTML served; ensure asset paths and that static files are included"; else echo "Built js file looks ok"; fi; else echo "No js file found in build directory"; fi; else echo "No build dir - maybe Next.js; running next build instead"; fi && npx vercel deploy --prod --yes
